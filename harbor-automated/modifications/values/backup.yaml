# PostgreSQL Backup to S3 Configuration
# Backs up Harbor's PostgreSQL database to AWS S3 (or S3-compatible storage)

backup:
  # Enable/disable backup CronJob
  enabled: false

  # Cron schedule (default: every 30 minutes)
  schedule: "*/30 * * * *"

  # Job history
  failedJobsHistoryLimit: 1
  successfulJobsHistoryLimit: 3
  suspend: false

  # Backup image
  image: relizaio/psql-awscli:25.11.0@sha256:d349d0b4780f560b0aba0432c9761180231c17526478799693a93d5b3a18f5df
  imagePullPolicy: IfNotPresent

  # Dump file prefix
  dumpPrefix: "dbdump-harbor-registry"

  # PostgreSQL connection settings
  postgresql:
    # Username for database connection
    username: postgres
    # Database name to backup
    database: registry
    # Host (leave empty to auto-detect from relizapostgresql)
    host: ""

    # Option 1: Use existing secret for password
    existingSecret: ""
    existingSecretKey: "password"

    # Option 2: Provide password directly (only used if existingSecret is empty)
    password: ""

  # S3 storage settings
  s3:
    # S3 bucket name (required)
    bucket: ""
    # AWS region
    region: "us-east-1"
    # Custom endpoint for S3-compatible storage (e.g., MinIO)
    endpoint: ""

    # Option 1: Use existing secret for AWS credentials
    existingSecret: ""
    existingSecretAccessKeyId: "aws-access-key-id"
    existingSecretAccessKeySecret: "aws-secret-access-key"

    # Option 2: Provide credentials directly (only used if existingSecret is empty)
    accessKeyId: ""
    secretAccessKey: ""

  # Skopeo (container image) backup to S3
  skopeo:
    # Enable/disable skopeo backup CronJob
    enabled: false
    # Cron schedule (default: every 30 minutes)
    schedule: "*/30 * * * *"
    # S3 bucket name
    bucket: none
    # Backup prefix
    prefix: skopeo
    # AWS region
    aws_region: ca-central-1
    # Skopeo backuper image
    image: registry.relizahub.com/library/skopeo-backuper
    # Existing secret for AWS credentials
    existingSecret: "aws-backups"
    existingSecretAccessKeyId: "aws-access-key-id"
    existingSecretAccessKeySecret: "aws-secret-access-key"
    # Existing secret for encryption password
    existingEncryptionSecret: "backup-encryption"
    existingEncryptionSecretKey: "encryption-password"

  # Resource limits
  resources: {}
  #  limits:
  #    cpu: 500m
  #    memory: 512Mi
  #  requests:
  #    cpu: 100m
  #    memory: 128Mi

  # Node selector
  nodeSelector: {}

  # Tolerations
  tolerations: []
